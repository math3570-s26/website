<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.19">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Dr.&nbsp;Cheng-Han Yu   Department of Mathematical and Statistical Sciences   Marquette University">
<title>Data Wrangling - one data frame üõ† ‚Äì MATH/COSC 3570 - Spring 2026</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-46eeb4c476de49ef7df495821a6125d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-38b22635d8ba2828809dae622215a440.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="../site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<meta property="og:title" content="Data Wrangling - one data frame r emo::ji('hammer_and_wrench') ‚Äì MATH/COSC 3570 - Spring 2026">
<meta property="og:description" content="MATH/COSC 3570 Introduction to Data Science">
<meta property="og:image" content="https://math3570-s26.github.io/website/slides/images/12-dplyr-1/dplyr-part-of-tidyverse.png">
<meta property="og:site_name" content="MATH/COSC 3570 - Spring 2026">
<meta property="og:image:height" content="1184">
<meta property="og:image:width" content="930">
</head>
<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Data Wrangling - one data frame üõ†</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto"><div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/logo.png" alt="" class="sidebar-logo light-content py-0 d-lg-inline d-none"><img src="../images/logo.png" alt="" class="sidebar-logo dark-content py-0 d-lg-inline d-none"></a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/math3570-s26" title="GitHub organization" class="quarto-navigation-tool px-1" aria-label="GitHub organization"><i class="bi bi-github"></i></a>
    <a href="https://d2l.mu.edu/d2l/home/630428" title="D2L" class="quarto-navigation-tool px-1" aria-label="D2L"><i class="bi bi-person-fill"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Course information</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../course-syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">AI Activities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ai_act_guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guideline and Policy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ai_example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AI Project Example</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ai.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AI Project Topics</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Mini Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Topics and Works</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Final Project</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../present-description-final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Guideline and Policy</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../present-work-final.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Project Group and Proposal</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="12-dplyr-1-slides.html"><i class="bi bi-file-slides"></i>RevealJS (live)</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Data Wrangling - one data frame üõ†</h1>
<p class="subtitle lead">MATH/COSC 3570 Introduction to Data Science</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Cheng-Han Yu <br> Department of Mathematical and Statistical Sciences <br> Marquette University </p>
          </div>
  </div>
    
  
    
  </div>
  


</header><section id="section" class="level1" data-visibility="hidden"><h1 data-visibility="hidden"></h1>
<section id="section-1" class="level2"><h2 class="anchored" data-anchor-id="section-1"></h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="https://raw.githubusercontent.com/hadley/r4ds/main/diagrams/data-science/wrangle.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<ul>
<li>Welcome back</li>
<li>This week: introduce tools of tidyverse for data wrangling</li>
<li>learn how to easily clean or transform our data so that we can extract some important properties of the data, and the data are ready for visualization, modeling and analysis.</li>
</ul>
</div>
<!-- # {background-color="#A7D5E8"} -->
</section></section><section id="section-2" class="level1" data-background-color="#A7D5E8" data-background-image="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/dplyr.png" data-background-size="30%" data-background-position="90% 50%"><h1 data-background-color="#A7D5E8" data-background-image="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/dplyr.png" data-background-size="30%" data-background-position="90% 50%"></h1>
<div class="left">
<h1>
Grammar of Data Manipulation
</h1>
<!-- <h3>[htmlwidgets](http://www.htmlwidgets.org/): leaflet, dygraphs, networkD3</h3> -->
</div>
<div class="notes">
<ul>
<li>Starting this week, we are going to talk about Grammar of Data Manipulation or Grammar of Data Wrangling.</li>
<li>In particular, we are going to use the tidyverse package dplyr to manipulate or transform our data.</li>
<li>If you become a data scientist after college, you will find that you spend most of the time cleaning or wrangling your data because the raw data usually look ugly, big and unorganized, and you have to grab what you really need for your analysis. Once the data set is ready, fitting a machine learning model or run an algorithm is just couple lines of code. Very easy because nowadays, many models and algorithms have been wrapped in a function. You just need to call the function.</li>
<li>You may feel a little bored the coming two weeks because I think data wrangling is not as fun as data visualization. But we have no choice. It is a must-have skill to be a data scientist, and I believe you will not learn this in other courses, but in this course only, or maybe in my course only.</li>
<li>All right. Let‚Äôs begin.</li>
</ul>
</div>
<section id="grammar-of-data-wrangling-dplyr" class="level2"><h2 class="anchored" data-anchor-id="grammar-of-data-wrangling-dplyr">Grammar of Data Wrangling: <a href="https://dplyr.tidyverse.org/index.html">dplyr</a> üì¶</h2>
<ul>
<li>based on the concepts of functions as <strong>verbs</strong> that manipulate data frames</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/12-dplyr-1/dplyr-part-of-tidyverse.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li>
<code>mutate</code>: <span class="green"><em>create</em></span> new columns from the existing<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>
</li>
<li>
<code>filter</code>: pick <em><span class="green">rows matching criteria</span></em>
</li>
<li>
<code>slice</code>: pick <em><span class="green">rows using index(es)</span></em>
</li>
<li>
<code>distinct</code>: filter for <span class="green"><em>unique</em> rows</span>
</li>
<li>
<code>select</code>: pick <em><span class="green">columns</span> by name</em>
</li>
<li>
<code>summarise</code>: reduce variables to values</li>
<li>
<code>group_by</code>: for grouped operations</li>
<li>
<code>arrange</code>: reorder rows</li>
<li>‚Ä¶ (many more)</li>
</ul>
</div>
</div>
<div class="notes">
<ul>
<li>So Grammar of Data Wrangling is based on the concepts of functions as <strong>verbs</strong> that manipulate data frames. Using these verbs in coding is simple, intuitive and straightforward. They let you know what you are doing on your data.</li>
<li>And the package that does this is called dplyr.</li>
<li>This package offers a variety of functions each of which is a verb, as listed here, mutate, filter, slice, distinct. Is distinct a verb??</li>
<li>there is no rule without an exception</li>
<li>Anyway, we will be going through these functions that help us manipulate or transform our data. OK</li>
</ul>
</div>
</section><section id="rules-of-dplyr-functions" class="level2"><h2 class="anchored" data-anchor-id="rules-of-dplyr-functions">Rules of <strong>dplyr</strong> Functions</h2>
<div class="red">
<div class="large">
<ul>
<li><p>First argument is <em>always</em> a <strong>data frame</strong></p></li>
<li><p>Subsequent arguments say what to do with that data frame</p></li>
<li><p><em>Always</em> return a <strong>data frame</strong></p></li>
<li><p>Don‚Äôt modify in place</p></li>
</ul>
</div>
</div>
<div class="notes">
<ul>
<li>So there are four rules of dplyr functions.</li>
<li>First argument is <em>always</em> a <strong>data frame</strong>
</li>
<li>Subsequent arguments say what to do with that data frame</li>
<li>
<em>Always</em> return a <strong>data frame</strong>, so data frame in, data frame out.</li>
<li>Don‚Äôt modify in place, meaning that when we apply a function of dplyr to the data, we are not changing that data frame. We have option to re-save our result, either overwrite the existing data frame that we have or as a separate object, but we are not modifying the data frame in place.</li>
</ul>
</div>
</section><section id="data-us-gun-murders-by-state-for-2010" class="level2"><h2 class="anchored" data-anchor-id="data-us-gun-murders-by-state-for-2010">Data: US gun murders by state for 2010</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">murders</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"./data/murders.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 5
  state      abb   region population total
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 Alabama    AL    South     4779736   135
2 Alaska     AK    West       710231    19
3 Arizona    AZ    West      6392017   232
4 Arkansas   AR    South     2915918    93
5 California CA    West     37253956  1257
6 Colorado   CO    West      5029196    65
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>The data set we are going to use as an illustrative example is again the murders data set in the dslabs package with the book Intro to Data Science</li>
<li>It is of R base data frame type with 51 observations and 5 variables.</li>
<li>Notice that region variable here is a factor, which may not make sense and we can convert it into a character vector if needed.</li>
<li>And we can change its data type to modern tibble data frame, again use as_tibble() function.</li>
</ul>
</div>
</section><section id="adding-a-new-variable-column-with-mutate" class="level2"><h2 class="anchored" data-anchor-id="adding-a-new-variable-column-with-mutate">Adding a New Variable (Column) with <a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate()</code></a>
</h2>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code> takes
<ul>
<li>a data frame as the 1st argument</li>
<li>the name and values of the variable as the 2nd argument using format <code>name = values</code>.</li>
</ul>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">murders</span> <span class="op">&lt;-</span> <span class="va">murders</span> <span class="op">|&gt;</span>  </span>
<span>     <span class="fu">mutate</span><span class="op">(</span>rate <span class="op">=</span> <span class="va">total</span> <span class="op">/</span> <span class="va">population</span> <span class="op">*</span> <span class="fl">100000</span><span class="op">)</span><span class="op">)</span> <span class="co">#&lt;&lt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 6
  state      abb   region population total  rate
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Alabama    AL    South     4779736   135  2.82
2 Alaska     AK    West       710231    19  2.68
3 Arizona    AZ    West      6392017   232  3.63
4 Arkansas   AR    South     2915918    93  3.19
5 California CA    West     37253956  1257  3.37
6 Colorado   CO    West      5029196    65  1.29
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
<p>. . .</p>
<ul>
<li><p><code>total</code> and <code>population</code> inside the function are <strong>not</strong> defined in our R environment.</p></li>
<li><p><code>dplyr</code> functions know to look for variables in the data frame provided in the 1st argument.</p></li>
</ul>
<div class="notes">
<ul>
<li>OK now let‚Äôs begin playing the the data set.</li>
<li>First, we can add a New Variable into the existing data set with the function mutate().</li>
<li>Remember, variables are stored by columns, and so adding new variables means add more columns to the data set.</li>
<li>The function <code>mutate()</code> takes the data frame as a first argument and the name and values of the variable as a second argument using the convention <code>name = values</code>.</li>
<li>Here, I compute the murder rate as the total number of murders divided by population and times 100,000. So the rate means the incidence rate per 100,000 people</li>
<li>
<code>total</code> and <code>population</code> inside the function are <strong>not</strong> defined in our R environment, but we didn‚Äôt get an error.</li>
<li>Functions in <strong>dplyr</strong> know to look for variables in the data frame provided in the first argument. <code>total</code> will have the values in <code>murders_tbl$total</code>.</li>
<li>Now you can see the new data set has a new column variable <code>rate</code> shown in the last column.</li>
<li>Use relocate() to change column positions, using the same syntax as select() to make it easy to move blocks of columns at once. <!-- - `total` will have the values in `murders$total` -->
</li>
</ul>
<p>mutate() creates new columns that are functions of existing variables. It can also modify (if the name is the same as an existing column) and delete columns (by setting their value to NULL). mutate( .data, ‚Ä¶, .by = NULL, .keep = c(‚Äúall‚Äù, ‚Äúused‚Äù, ‚Äúunused‚Äù, ‚Äúnone‚Äù), .before = NULL, .after = NULL )</p>
</div>
</section><section id="filtering-observations-rows-with-filter" class="level2"><h2 class="anchored" data-anchor-id="filtering-observations-rows-with-filter">Filtering Observations (Rows) with <a href="https://dplyr.tidyverse.org/reference/filter.html"><code>filter()</code></a>
</h2>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> takes a
<ul>
<li>data frame as the 1st argument</li>
<li>
<em>conditional</em> statement as the 2nd. (pick rows matching criteria)</li>
</ul>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># filter the data table to only show the entries for which </span></span>
<span><span class="co"># the murder rate is lower than 0.7</span></span>
<span><span class="va">murders</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rate</span> <span class="op">&lt;</span> <span class="fl">0.7</span><span class="op">)</span> <span class="co">#&lt;&lt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 6
  state         abb   region        population total  rate
  &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Hawaii        HI    West             1360301     7 0.515
2 Iowa          IA    North Central    3046355    21 0.689
3 New Hampshire NH    Northeast        1316470     5 0.380
4 North Dakota  ND    North Central     672591     4 0.595
5 Vermont       VT    Northeast         625741     2 0.320</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>All right. We add columns by mutate() function, and we pick observations (rows) with filter() function.</li>
<li>
<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> function again takes the data frame as the first argument and then the conditional statement as the second.</li>
<li>So we pick rows by matching the criteria of the conditional statement in the second argument of the filter() function.</li>
<li>For example, here I filter the data table to only show the obs for which the murder rate is lower than 0.71 Note that when a condition evaluates to NA the row will be dropped, unlike base subsetting with [.</li>
</ul>
</div>
</section><section id="filter-for-many-conditions-at-once" class="level2"><h2 class="anchored" data-anchor-id="filter-for-many-conditions-at-once">
<code>filter()</code> for Many Conditions at Once</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span>  </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rate</span> <span class="op">&gt;</span> <span class="fl">0.1</span> <span class="op">&amp;</span> <span class="va">rate</span> <span class="op">&lt;</span> <span class="fl">0.7</span>,  <span class="co">#&lt;&lt;</span></span>
<span>           <span class="va">region</span> <span class="op">==</span> <span class="st">"Northeast"</span><span class="op">)</span>  <span class="co">#&lt;&lt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 6
  state         abb   region    population total  rate
  &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 New Hampshire NH    Northeast    1316470     5 0.380
2 Vermont       VT    Northeast     625741     2 0.320</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>We can actually use several conditions at once to filter the observations</li>
<li>For example, here we want the observations whose murder rate is between 0.1 and 0.71, and their region is Northeast.</li>
<li>You can see that only two observations satisfy the conditions, New Hampshire and Vermont.</li>
<li>Use one single &amp; to have a logical vector</li>
<li>You can also write rate &gt;= 0.1, rate &lt;= 0.71. This way we separate the condition rate &gt;= 0.1 &amp; rate &lt;= 0.71 into 2 conditions.</li>
<li>Theoretically You can provide as many conditions as you want. The conditions are combined with &amp;</li>
</ul>
</div>
</section><section id="logical-operators" class="level2" data-visibility="hidden"><h2 data-visibility="hidden" class="anchored" data-anchor-id="logical-operators">Logical Operators</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 32%">
<col style="width: 31%">
<col style="width: 22%">
</colgroup>
<thead><tr class="header">
<th>operator</th>
<th>definition</th>
<th>operator</th>
<th>definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>&lt;</code></td>
<td>less than</td>
<td>
<code>x</code>&nbsp;|&nbsp;<code>y</code>
</td>
<td>
<code>x</code> OR <code>y</code>
</td>
</tr>
<tr class="even">
<td><code>&lt;=</code></td>
<td>less than or equal to</td>
<td><code>is.na(x)</code></td>
<td>if <code>x</code> is <code>NA</code>
</td>
</tr>
<tr class="odd">
<td><code>&gt;</code></td>
<td>greater than</td>
<td><code>!is.na(x)</code></td>
<td>if <code>x</code> is not <code>NA</code>
</td>
</tr>
<tr class="even">
<td><code>&gt;=</code></td>
<td>greater than or equal to</td>
<td><code>x %in% y</code></td>
<td>if <code>x</code> is in <code>y</code>
</td>
</tr>
<tr class="odd">
<td><code>==</code></td>
<td>exactly equal to</td>
<td><code>!(x %in% y)</code></td>
<td>if <code>x</code> is not in <code>y</code>
</td>
</tr>
<tr class="even">
<td><code>!=</code></td>
<td>not equal to</td>
<td><code>!x</code></td>
<td>not <code>x</code>
</td>
</tr>
<tr class="odd">
<td><code>x &amp; y</code></td>
<td>
<code>x</code> AND <code>y</code>
</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="notes">
<ul>
<li>We have talked about this. These are logical operators you can use in the conditions of the filter() function.</li>
</ul>
</div>
</section><section id="slice-for-certain-rows-using-indexes" class="level2"><h2 class="anchored" data-anchor-id="slice-for-certain-rows-using-indexes">
<a href="https://dplyr.tidyverse.org/reference/slice.html"><code>slice()</code></a> for Certain Rows using Indexes</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># 3rd to 6th row</span></span>
<span><span class="va">murders</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">slice</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 6
  state      abb   region population total  rate
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Arizona    AZ    West      6392017   232  3.63
2 Arkansas   AR    South     2915918    93  3.19
3 California CA    West     37253956  1257  3.37
4 Colorado   CO    West      5029196    65  1.29</code></pre>
</div>
</div>
<p>. . .</p>
<div class="question">
<p>How do we subset rows using matrix indexing?</p>
</div>
<p>. . .</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span>, <span class="op">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 6
  state      abb   region population total  rate
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Arizona    AZ    West      6392017   232  3.63
2 Arkansas   AR    South     2915918    93  3.19
3 California CA    West     37253956  1257  3.37
4 Colorado   CO    West      5029196    65  1.29</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>OK. Slice. We use slice() function to subset observations or rows using indexes.</li>
<li>Same as other functions, the first argument is a data frame, so I use the pipe operator sending murders_tbl data set to the slice function.</li>
<li>It is the same as treating a data drame as a matrix and subsetting the rows, which is the usual way we do before learning this function.</li>
<li>So here we extract row 3 to row 6 of the data set.</li>
<li>microbenchmark::microbenchmark(slice(murders_tbl, 3:6), murders_tbl[3:6, ])</li>
<li>You cannot(can?) write murders_tbl[3:6, ] as a function call. How? slice_head() and slice_tail() select the first or last rows. slice_sample() randomly selects rows. slice_min() and slice_max() select rows with highest or lowest values of a variable.</li>
</ul>
</div>
</section><section id="distinct-to-filter-for-unique-rows" class="level2"><h2 class="anchored" data-anchor-id="distinct-to-filter-for-unique-rows">
<a href="https://dplyr.tidyverse.org/reference/distinct.html"><code>distinct()</code></a> to Filter for Unique Rows</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Select only unique/distinct rows from a data frame</span></span>
<span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">distinct</span><span class="op">(</span><span class="va">region</span><span class="op">)</span>  <span class="co">## default</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 1
  region       
  &lt;chr&gt;        
1 South        
2 West         
3 Northeast    
4 North Central</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">distinct</span><span class="op">(</span><span class="va">region</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">## keep all other variables</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 6
  state       abb   region        population total  rate
  &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Alabama     AL    South            4779736   135  2.82
2 Alaska      AK    West              710231    19  2.68
3 Connecticut CT    Northeast        3574097    97  2.71
4 Illinois    IL    North Central   12830632   364  2.84</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>We can use distinct() function to select only unique/distinct rows from a data frame.</li>
<li>For example here, we use variable region to decide the unique rows. By default, the function only gives us the unique values of the variable region.</li>
<li>Do you wonder why we have the order South, West, Northeast, and North Central?</li>
<li>Actually, these values are the values of some rows.</li>
<li>If we keep all variables, we see that the south is the south for Alabama, west for alaska, northeast for connecticut, and North central for illinois.</li>
<li>distinct() functions grabs rows that first has each of the unique values of region variable.</li>
<li>So Alabama is the first observation that has value South, Alaska is the first observation that has value West, Connecticut is the first observation that has value Northeast, and Illinois is the first observation that has value North Central.</li>
<li>microbenchmark::microbenchmark(distinct(murders_tbl, region), as_tibble(unique(murders_tbl$region)))</li>
</ul>
</div>
</section><section id="distinct-grabs-first-row-of-the-unique-value" class="level2"><h2 class="anchored" data-anchor-id="distinct-grabs-first-row-of-the-unique-value">
<code>distinct()</code> Grabs First Row of The Unique Value</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">distinct</span><span class="op">(</span><span class="va">region</span>, .keep_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 6
  state       abb   region        population total  rate
  &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Alabama     AL    South            4779736   135  2.82
2 Alaska      AK    West              710231    19  2.68
3 Connecticut CT    Northeast        3574097    97  2.71
4 Illinois    IL    North Central   12830632   364  2.84</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 6
  state      abb   region population total  rate
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Alabama    AL    South     4779736   135  2.82
2 Alaska     AK    West       710231    19  2.68
3 Arizona    AZ    West      6392017   232  3.63
4 Arkansas   AR    South     2915918    93  3.19
5 California CA    West     37253956  1257  3.37</code></pre>
</div>
</div>
</section><section id="selecting-columns-with-select" class="level2"><h2 class="anchored" data-anchor-id="selecting-columns-with-select">Selecting Columns with <a href="https://dplyr.tidyverse.org/reference/select.html"><code>select()</code></a>
</h2>
<ul>
<li><p>In <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code>, the 1st argument is a data frame, followed by variable names being selected in the data.</p></li>
<li><p><strong>The order of variable names matters!</strong></p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">murders</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "state"      "abb"        "region"     "population" "total"     
[6] "rate"      </code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># select three columns, assign this to a new object</span></span>
<span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="va">region</span>, <span class="va">rate</span>, <span class="va">state</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 3
  region  rate state     
  &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;     
1 South   2.82 Alabama   
2 West    2.68 Alaska    
3 West    3.63 Arizona   
4 South   3.19 Arkansas  
5 West    3.37 California
6 West    1.29 Colorado  
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>filter(), slice() and distinct()are functions for picking rows.</li>
<li>select() is a function for picking columns or variables.</li>
<li>Here, I select three columns region, rate, and state.</li>
<li>Notice that the order of variable names matters! The original data set has variable order ‚Äústate‚Äù ‚Äúabb‚Äù ‚Äúregion‚Äù ‚Äúpopulation‚Äù ‚Äútotal‚Äù ‚Äúrate‚Äù.</li>
<li>But the resulting data frame will have the variables or columns ordered as region, rate, state because this is the order you specify in the select().</li>
<li>If you don‚Äôt know the column names, you can select by position. murders_tbl %&gt;% select(3, 6, 1)</li>
</ul>
</div>
</section><section id="select-to-exclude-variables" class="level2"><h2 class="anchored" data-anchor-id="select-to-exclude-variables">
<code>select()</code> to Exclude Variables</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## exclude variable population</span></span>
<span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">population</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 5
  state      abb   region total  rate
  &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 Alabama    AL    South    135  2.82
2 Alaska     AK    West      19  2.68
3 Arizona    AZ    West     232  3.63
4 Arkansas   AR    South     93  3.19
5 California CA    West    1257  3.37
6 Colorado   CO    West      65  1.29
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>If you want to exclude some variables, just provide a vector of variables you want to remove, and put a minus sign in front of it.</li>
<li>Here we remove the population variable.</li>
</ul>
</div>
</section><section id="select-a-range-of-variables" class="level2"><h2 class="anchored" data-anchor-id="select-a-range-of-variables">
<code>select()</code> a Range of Variables</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">murders</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "state"      "abb"        "region"     "population" "total"     
[6] "rate"      </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## from region to rate</span></span>
<span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="va">region</span><span class="op">:</span><span class="va">rate</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 4
  region population total  rate
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 South     4779736   135  2.82
2 West       710231    19  2.68
3 West      6392017   232  3.63
4 South     2915918    93  3.19
5 West     37253956  1257  3.37
6 West      5029196    65  1.29
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>We can also select a range of variables.</li>
<li>For example, we select all variables for region to rate by using region:rate, just as we create a sequence of numbers from 1 to 5 using 1:5.</li>
<li>murders_tbl %&gt;% select(3:6)</li>
</ul>
</div>
</section><section id="select-variables-with-certain-characteristics" class="level2"><h2 class="anchored" data-anchor-id="select-variables-with-certain-characteristics">
<code>select()</code> Variables with Certain Characteristics</h2>
<ul>
<li>
<code>starts_with()</code> is a <a href="https://tidyselect.r-lib.org/index.html"><strong>tidy-select</strong></a> helper function.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="fu">starts_with</span><span class="op">(</span><span class="st">"r"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 2
  region  rate
  &lt;chr&gt;  &lt;dbl&gt;
1 South   2.82
2 West    2.68
3 West    3.63
4 South   3.19
5 West    3.37
6 West    1.29
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>We can also some helper functions to select variables with some condition.</li>
<li>For example, we can use a helper function starts_with() to select variables whose name starts with letter ‚Äúr‚Äù.</li>
<li>And so region and rate variables are selected.</li>
</ul>
</div>
</section><section id="select-variables-with-certain-characteristics-1" class="level2"><h2 class="anchored" data-anchor-id="select-variables-with-certain-characteristics-1">
<code>select()</code> Variables with Certain Characteristics</h2>
<ul>
<li>
<code>ends_with()</code> is a <a href="https://tidyselect.r-lib.org/reference/index.html"><strong>tidy-select</strong></a> helper function.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="fu">ends_with</span><span class="op">(</span><span class="st">"ion"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 2
  region population
  &lt;chr&gt;       &lt;dbl&gt;
1 South     4779736
2 West       710231
3 West      6392017
4 South     2915918
5 West     37253956
6 West      5029196
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>We can also select variables whose name ends with ‚Äúion‚Äù</li>
<li>And so region and population variables are selected.</li>
</ul>
</div>
</section><section id="tidy-select-helpers" class="level2"><h2 class="anchored" data-anchor-id="tidy-select-helpers">
<a href="https://tidyselect.r-lib.org/reference/index.html"><strong>tidy-select</strong></a> Helpers<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>
</h2>
<ul>
<li>
<code>starts_with()</code>: Starts with a prefix</li>
<li>
<code>ends_with()</code>: Ends with a suffix</li>
<li>
<code>contains()</code>: Contains a literal string</li>
<li>
<code>num_range()</code>: Matches a numerical range like x01, x02, x03</li>
<li>
<code>one_of()</code>: Matches variable names in a character vector</li>
<li>
<code>everything()</code>: Matches all variables</li>
<li>
<code>last_col()</code>: Select last variable, possibly with an offset</li>
<li>
<code>matches()</code>: Matches a regular expression (a sequence of symbols/characters expressing a string/pattern to be searched for within text)</li>
</ul>
<div class="notes">
<ul>
<li>Here is a list of select helpers.</li>
<li>I am not able to go through every helper in detail. But they can be very useful depending on your goal.</li>
<li>Absolutely check their help page to learn how to use them and review the examples in the help page. OK.</li>
</ul>
</div>
</section><section id="rationale-for-pipe-operator" class="level2"><h2 class="anchored" data-anchor-id="rationale-for-pipe-operator">Rationale for Pipe Operator</h2>
<div class="question">
<p>How do we show three variables (state, region, rate) for states that have murder rates below 0.7?</p>
</div>
<ul>
<li>Method 1: Define the intermediate object <code>new_table</code>
</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">new_table</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">murders</span>, <span class="va">state</span>, <span class="va">region</span>, <span class="va">rate</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">new_table</span>, <span class="va">rate</span> <span class="op">&lt;</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 3
  state         region         rate
  &lt;chr&gt;         &lt;chr&gt;         &lt;dbl&gt;
1 Hawaii        West          0.515
2 Iowa          North Central 0.689
3 New Hampshire Northeast     0.380
4 North Dakota  North Central 0.595
5 Vermont       Northeast     0.320</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>Remember we talked about the pipe operator, right? But we haven‚Äôt really used it often.</li>
<li>But it kinda make much sense to use the pipe operator for data manipulation using dplyr functions.</li>
<li>Because the first argument of dplyr function is always a data frame and its function output is also a data frame, which can be the input of another dplyr function.</li>
<li>So if we wanna manipulate our data set via several different actions using the dplyr functions step by step, pipe operator can be very useful. Let‚Äôs see why.</li>
<li>How do we show three variables (state, region, rate) for states that have murder rate below 0.71?</li>
<li>We can first select three variables state, region, rate, and save the resulting output to an object new_table, and then apply filter() function on the new_table to get the observations having murder rate less than 0.71</li>
<li>In fact, the object new_table is unnecessary. The table is not what we want, and any object created in the R environment occupies some memory space.</li>
</ul>
</div>
</section><section id="rationale-for-pipe-operator-1" class="level2"><h2 class="anchored" data-anchor-id="rationale-for-pipe-operator-1">Rationale for Pipe Operator</h2>
<div class="question">
<p>How do we show three variables (state, region, rate) for states that have murder rates below 0.7?</p>
</div>
<ul>
<li>Method 2: Apply one function onto the other with no intermediate object</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## not so easy to read and understand</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">select</span><span class="op">(</span><span class="va">murders</span>, <span class="va">state</span>, <span class="va">region</span>, <span class="va">rate</span><span class="op">)</span>, <span class="va">rate</span> <span class="op">&lt;</span> <span class="fl">0.7</span><span class="op">)</span> </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 3
  state         region         rate
  &lt;chr&gt;         &lt;chr&gt;         &lt;dbl&gt;
1 Hawaii        West          0.515
2 Iowa          North Central 0.689
3 New Hampshire Northeast     0.380
4 North Dakota  North Central 0.595
5 Vermont       Northeast     0.320</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>If we don‚Äôt use new_table object, we can put the code select(murders_tbl, state, region, rate) directly on the first argument of filter() function as the data input.</li>
<li>This gives us the same resulting data frame.</li>
<li>However, the code is not very easy to read and understand because when we read the code from left to right, it starts with filter, and then select, but we actually do the selection first. Also, the second argument or the condition used in the filter() function is at the end of the code, which is far away from the function name at the beginning.</li>
</ul>
</div>
</section><section id="rationale-for-pipe-operator-2" class="level2"><h2 class="anchored" data-anchor-id="rationale-for-pipe-operator-2">Rationale for Pipe Operator</h2>
<ul>
<li>The code that looks like a verbal description of what we want to do without intermediate objects:</li>
</ul>
<blockquote class="blockquote">
<p><strong>data &gt; <em>select()</em> &gt; data after selecting &gt; <em>filter()</em> &gt; data after selecting and filtering</strong></p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">select</span><span class="op">(</span><span class="va">state</span>, <span class="va">region</span>, <span class="va">rate</span><span class="op">)</span> <span class="op">|&gt;</span>  </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rate</span> <span class="op">&lt;</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 √ó 3
  state         region         rate
  &lt;chr&gt;         &lt;chr&gt;         &lt;dbl&gt;
1 Hawaii        West          0.515
2 Iowa          North Central 0.689
3 New Hampshire Northeast     0.380
4 North Dakota  North Central 0.595
5 Vermont       Northeast     0.320</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>Pipe Operator let us write code that looks more like a description of what we want to do without intermediate objects.</li>
<li>We start with the original data set, then we select variables, and then we filter observations.</li>
<li>So our code can be like It‚Äôs more clear and intuitive, right?</li>
</ul>
</div>
</section><section id="summarizing-data-summarize" class="level2"><h2 class="anchored" data-anchor-id="summarizing-data-summarize">Summarizing Data ‚Äì <code>summarize()</code>
</h2>
<ul>
<li>
<code>summarize()</code> provides a data frame that summarizes the statistics we compute.</li>
</ul>
<!-- - The output is always a data frame. --><div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">heights</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"./data/heights.csv"</span><span class="op">)</span></span>
<span><span class="fu">glimpse</span><span class="op">(</span><span class="va">heights</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,050
Columns: 2
$ sex    &lt;chr&gt; "Male", "Male", "Male", "Male", "Male", "Female", "Female", "Fe‚Ä¶
$ height &lt;dbl&gt; 75, 70, 68, 74, 61, 65, 66, 62, 66, 67, 72, 72, 69, 68, 69, 66,‚Ä¶</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>The <code>summarize()</code> function in <strong>dplyr</strong> provides a way to compute summary statistics.</li>
<li>Again, its first argument and output are always data frames.</li>
<li>We are gonna use another data set heights in the dslabs package to demonstrate the usage of function.</li>
<li>The data set only has two variables, sex and height.</li>
<li>height is a variable, but heights is the data set</li>
</ul>
</div>
</section><section id="summarizing-data-summarize-1" class="level2"><h2 class="anchored" data-anchor-id="summarizing-data-summarize-1">Summarizing Data ‚Äì <code>summarize()</code>
</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">s</span> <span class="op">&lt;-</span> <span class="va">heights</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">summarize</span><span class="op">(</span>avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>,  </span>
<span>              stdev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>,</span>
<span>              med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>, </span>
<span>              min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 4
    avg stdev   med   min
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1  64.9  3.76  65.0    51</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s</span><span class="op">$</span><span class="va">avg</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 64.9</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">s</span><span class="op">$</span><span class="va">min</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 51</code></pre>
</div>
</div>
<div class="alert">
<p><code>summarise()</code> produces a <em>new data frame</em> that is not any variant of the original data frame.</p>
</div>
<div class="notes">
<ul>
<li>Suppose we want to find the mean and standard deviation of female height and store the two values as a data frame, we can start with the data set heights, then filter or grab the observations that have sex Female, and then with the filtered data, use the summarize function to create a data frame of two variables ‚Äúaverage‚Äù and ‚Äústandard_deviation‚Äù computed from the variable height.</li>
<li>You see that the resulting object s is a data frame with two variables.</li>
<li>Notice that <code>summarise()</code> changes the data frame entirely, it collapses rows down to a single summary statistic, and removes all columns that are irrelevant to the calculation. Basically, the resulting df is not any variant of the original df anymore.</li>
</ul>
<p><code>summarise()</code> changes the data frame entirely, it collapses rows down to a single summary statistic, and removes all columns that are irrelevant to the calculation.</p>
</div>
</section><section id="summarizing-data-summarize-2" class="level2"><h2 class="anchored" data-anchor-id="summarizing-data-summarize-2">Summarizing Data ‚Äì <code>summarize()</code>
</h2>
<ul>
<li>One variable <code>quans</code> that has 3 values. The output is a 3 by 1 data frame.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="va">heights</span> <span class="op">|&gt;</span>  </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">summarize</span><span class="op">(</span>quans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">height</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
‚Ñπ Please use `reframe()` instead.
‚Ñπ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 √ó 1
  quans
  &lt;dbl&gt;
1  61  
2  65.0
3  69  </code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>we will get a data frame with more than one row if the function we use in summarize() return a vector.</li>
<li>For example here, we compute the 01, 0.5, and 0.9 quantile of variable height, and call it quantiles. Then the resulting data frame will have 3 rows, basically a column vector with 3 elements. str(s2)</li>
</ul>
</div>
</section><section id="summarizing-data-summarize-3" class="level2" data-visibility="hidden"><h2 data-visibility="hidden" class="anchored" data-anchor-id="summarizing-data-summarize-3">Summarizing Data ‚Äì <code>summarize()</code>
</h2>
<ul>
<li>
<code>summarize()</code> always returns a data frame, which might be problematic when we want to use it as a numeric value with other operations or functions.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">rate_df</span> <span class="op">&lt;-</span> <span class="va">murders</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">summarize</span><span class="op">(</span>rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">total</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 √ó 1
   rate
  &lt;dbl&gt;
1  3.03</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">rate_df</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">rate_df</span>, <span class="fl">3</span><span class="op">)</span> <span class="co">## want a (atomic) vector of length 3, but get a list of length 3!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$rate
[1] 3.03

$rate
[1] 3.03

$rate
[1] 3.03</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>We use summarize() function and compute the variable rate. The result is a 1 by 1 data frame.</li>
</ul>
</div>
</section><section id="summarizing-data-pull" class="level2" data-visibility="hidden"><h2 data-visibility="hidden" class="anchored" data-anchor-id="summarizing-data-pull">Summarizing Data ‚Äì <code>pull()</code>
</h2>
<ul>
<li>
<code>pull()</code> accesses values or extract a single column in a data frame.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rate_num</span> <span class="op">&lt;-</span> <span class="va">rate_df</span> <span class="op">|&gt;</span>  </span>
<span>    <span class="fu">pull</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">rate_num</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">rate_num</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.03 3.03 3.03</code></pre>
</div>
</div>
<p>. . .</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="va">total</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 1
  total
  &lt;dbl&gt;
1   135
2    19
3   232
4    93
5  1257
6    65
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span> <span class="fu">pull</span><span class="op">(</span><span class="va">total</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  135   19  232   93 1257   65   97   38   99  669  376    7   12  364  142
[16]   21   63  116  351   11  293  118  413   53  120  321   12   32   84    5
[31]  246   67  517  286    4  310  111   36  457   16  207    8  219  805   22
[46]    2  250   93   27   97    5</code></pre>
</div>
</div>
</div>
</div>
<div class="notes">
<ul>
<li>If we want a number or a vector in general, we can use pull() function with the variable name rate inside the function.</li>
<li>Basically, pull() extract a single column as a vector, not a data frame. It‚Äôs like <code>$</code> for selecting a column. <code>murder_rate_df$rate</code>
</li>
<li>If we wanna keep the pipe operation style, using pull() function looks nicer. murder_rate_df %&gt;% <code>$</code>(rate)</li>
<li>murders_tbl[‚Äútotal‚Äù]: tibble</li>
<li>murders_tbl %&gt;% select(total): tibble</li>
<li>murders_tbl[[‚Äútotal‚Äù]]: vector</li>
<li>murders_tbl %&gt;% pull(total): vector</li>
</ul>
</div>
</section><section id="grouping-group_by" class="level2"><h2 class="anchored" data-anchor-id="grouping-group_by">Grouping ‚Äì <code>group_by()</code>
</h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">heights_group</span> <span class="op">&lt;-</span> <span class="va">heights</span> <span class="op">|&gt;</span> </span>
<span>     <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span>  <span class="co">#&lt;&lt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,050 √ó 2
# Groups:   sex [2]
  sex    height
  &lt;chr&gt;   &lt;dbl&gt;
1 Male       75
2 Male       70
3 Male       68
4 Male       74
5 Male       61
6 Female     65
# ‚Ñπ 1,044 more rows</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">heights_group</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "grouped_df" "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
</div>
<ul>
<li><p><code>heights_group</code> is a <strong>grouped data frame</strong>.</p></li>
<li><p>Tibbles are similar, but see <code>Groups: sex [2]</code> after grouping data by <code>sex</code>.</p></li>
<li><p><code>summarize()</code> behaves differently when acting on <code>grouped_df</code>.</p></li>
</ul>
<div class="notes">
<ul>
<li>A common operation in data exploration is to first split data into groups and then compute summaries for each group.</li>
<li>To group a data set by some variable, we can use group_by() function.</li>
<li>Here, we group the heights data set by the variable sex.</li>
<li>Outputs are similar, but we see <code>Groups: sex [2]</code> after grouping data by sex. [2] means there are two groups.</li>
<li>And now the heights_group data set has a new class called grouped_df.</li>
</ul>
</div>
</section><section id="group-and-summarize-group_by-summarize" class="level2"><h2 class="anchored" data-anchor-id="group-and-summarize-group_by-summarize">Group and Summarize: <code>group_by()</code> + <code>summarize()</code>
</h2>
<ul>
<li>
<code>summarize()</code> applies the summarization to <strong>each group separately</strong>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">heights</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">summarize</span><span class="op">(</span>avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>, stdev <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>, </span>
<span>              med <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span>, min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 5
  sex      avg stdev   med   min
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Female  64.9  3.76  65.0    51
2 Male    69.3  3.61  69      50</code></pre>
</div>
</div>
<p>. . .</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">murders</span> <span class="op">|&gt;</span>  </span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">summarize</span><span class="op">(</span>median_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 √ó 2
  region        median_rate
  &lt;chr&gt;               &lt;dbl&gt;
1 North Central        1.97
2 Northeast            1.80
3 South                3.40
4 West                 1.29</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>The <code>summarize()</code> function applies the summarization to <strong>each group separately</strong>.</li>
<li>Here we use the same summarize() function and compute the average and sd of the variable height as we previous did.</li>
<li>But if the the data set is a grouped data frame grouped by sex, the summarized output will show the avg and sd for each group, make and female separately.</li>
<li>Another example is that we first group the murders data by region, then when we compute the median murder rate, it will get the median murder rate for each region.</li>
<li>This is quite helpful when we want to explore the relationship between numerical and categorical variables. Like here, we discover that the murder rate in the south is the highest.</li>
<li>You can absolutely include some statistics summary in your project proposal when you describe your data.</li>
</ul>
</div>
</section><section id="sorting-rows-in-data-frames-arrange" class="level2"><h2 class="anchored" data-anchor-id="sorting-rows-in-data-frames-arrange">Sorting Rows in Data Frames ‚Äì <a href="https://dplyr.tidyverse.org/reference/arrange.html"><code>arrange()</code></a>
</h2>
<ul>
<li>
<code>arrange()</code> orders entire data tables.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## order the states by population size</span></span>
<span><span class="va">murders</span> <span class="op">|&gt;</span>  </span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="va">population</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 6
  state                abb   region        population total   rate
  &lt;chr&gt;                &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 Wyoming              WY    West              563626     5  0.887
2 District of Columbia DC    South             601723    99 16.5  
3 Vermont              VT    Northeast         625741     2  0.320
4 North Dakota         ND    North Central     672591     4  0.595
5 Alaska               AK    West              710231    19  2.68 
6 South Dakota         SD    North Central     814180     8  0.983
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>For ordering entire data tables, the dplyr function <code>arrange()</code> is useful.</li>
<li>We get to decide which column to sort by.</li>
<li>If we want to sort the observations of murders data set by population size, we just need to pipe the data set into arrange function and specify population variable.</li>
<li>How do we do the same thing with base R grammar, not tidyverse grammar?</li>
<li>murders[order(murders$population), ]</li>
</ul>
</div>
</section><section id="sorting-rows-in-data-frames-arrange-1" class="level2" data-visibility="hidden"><h2 data-visibility="hidden" class="anchored" data-anchor-id="sorting-rows-in-data-frames-arrange-1">Sorting Rows in Data Frames ‚Äì <code>arrange()</code>
</h2>
<ul>
<li>The function <code>desc()</code> transforms a vector so that it is in descending order.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## see the states by murder rate, from highest to lowest</span></span>
<span><span class="va">murders</span> <span class="op">|&gt;</span> </span>
<span>    <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">rate</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 51 √ó 6
  state                abb   region        population total  rate
  &lt;chr&gt;                &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 District of Columbia DC    South             601723    99 16.5 
2 Louisiana            LA    South            4533372   351  7.74
3 Missouri             MO    North Central    5988927   321  5.36
4 Maryland             MD    South            5773552   293  5.07
5 South Carolina       SC    South            4625364   207  4.48
6 Delaware             DE    South             897934    38  4.23
# ‚Ñπ 45 more rows</code></pre>
</div>
</div>
<div class="notes">
<ul>
<li>The function <code>desc()</code> transforms a vector so that it is in descending order.</li>
<li>With this function, we arrange states by murder rate in descending order.</li>
</ul>
</div>
</section><section id="section-3" class="level2"><h2 class="anchored" data-anchor-id="section-3"></h2>
<div class="lab">
<p><span style="color:blue"> <strong>15-dplyr</strong> </span> <!-- - Create the R script **lab13-dplyr.R** --></p>
<p>In <strong>lab.qmd</strong> <code>## Lab 15</code> section, import the <code>murders.csv</code> data and</p>
<ol type="1">
<li><p>Add <strong>(mutate)</strong> the variable <code>rate = total / population * 100000</code> to <code>murders</code> data (as I did).</p></li>
<li><p><strong>Filter</strong> states that are in <em>region Northeast or West</em> and their <em>murder rate is less than 1</em>.</p></li>
<li><p><strong>Select</strong> variables <code>state</code>, <code>region</code>, <code>rate</code>.</p></li>
</ol>
<ul>
<li><p>Print the output table after you do 1. to 3., and save it as object <code>my_states</code>.</p></li>
<li><p><strong>Group</strong> <code>my_states</code> <strong>by</strong> <code>region</code>. Then <strong>summarize</strong> data by creating variables <code>avg</code> and <code>stdev</code> that compute the mean and standard deviation of <code>rate</code>.</p></li>
<li><p><strong>Arrange</strong> the summarized table by <code>avg</code>.</p></li>
</ul>
</div>
</section><section id="section-4" class="level2"><h2 class="anchored" data-anchor-id="section-4"></h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>_______ <span class="ot">&lt;-</span> _______ <span class="sc">|&gt;</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(_______) <span class="sc">|&gt;</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(_______) <span class="sc">|&gt;</span> </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(_______)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>_______ <span class="sc">|&gt;</span>  </span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(______) <span class="sc">|&gt;</span> </span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(______) <span class="sc">|&gt;</span> </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(_______)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>          state    region  rate
1        Hawaii      West 0.515
2         Idaho      West 0.766
3         Maine Northeast 0.828
4 New Hampshire Northeast 0.380
5        Oregon      West 0.940
6          Utah      West 0.796
7       Vermont Northeast 0.320
8       Wyoming      West 0.887</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 √ó 3
  region      avg stdev
  &lt;fct&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 West      0.781 0.164
2 Northeast 0.509 0.278</code></pre>
</div>
</div>
</div>
</div>
</section></section><section id="section-5" class="level1" data-background-color="#ffde57" data-background-image="https://upload.wikimedia.org/wikipedia/commons/e/ed/Pandas_logo.svg" data-background-size="40%" data-background-position="90% 50%"><h1 data-background-color="#ffde57" data-background-image="https://upload.wikimedia.org/wikipedia/commons/e/ed/Pandas_logo.svg" data-background-size="40%" data-background-position="90% 50%"></h1>
<div class="left">
<h1>
Data Manipulation
</h1>
</div>
<div class="notes">
<p>https://towardsdatascience.com/python-pandas-vs-r-dplyr-5b5081945ccb</p>
</div>
<section id="section-6" class="level2"><h2 class="anchored" data-anchor-id="section-6"></h2>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>murders <span class="op">=</span> pd.read_csv(<span class="st">'./data/murders.csv'</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(murders)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   state abb         region  population  total
0                Alabama  AL          South     4779736    135
1                 Alaska  AK           West      710231     19
2                Arizona  AZ           West     6392017    232
3               Arkansas  AR          South     2915918     93
4             California  CA           West    37253956   1257
5               Colorado  CO           West     5029196     65
6            Connecticut  CT      Northeast     3574097     97
7               Delaware  DE          South      897934     38
8   District of Columbia  DC          South      601723     99
9                Florida  FL          South    19687653    669
10               Georgia  GA          South     9920000    376
11                Hawaii  HI           West     1360301      7
12                 Idaho  ID           West     1567582     12
13              Illinois  IL  North Central    12830632    364
14               Indiana  IN  North Central     6483802    142
15                  Iowa  IA  North Central     3046355     21
16                Kansas  KS  North Central     2853118     63
17              Kentucky  KY          South     4339367    116
18             Louisiana  LA          South     4533372    351
19                 Maine  ME      Northeast     1328361     11
20              Maryland  MD          South     5773552    293
21         Massachusetts  MA      Northeast     6547629    118
22              Michigan  MI  North Central     9883640    413
23             Minnesota  MN  North Central     5303925     53
24           Mississippi  MS          South     2967297    120
25              Missouri  MO  North Central     5988927    321
26               Montana  MT           West      989415     12
27              Nebraska  NE  North Central     1826341     32
28                Nevada  NV           West     2700551     84
29         New Hampshire  NH      Northeast     1316470      5
30            New Jersey  NJ      Northeast     8791894    246
31            New Mexico  NM           West     2059179     67
32              New York  NY      Northeast    19378102    517
33        North Carolina  NC          South     9535483    286
34          North Dakota  ND  North Central      672591      4
35                  Ohio  OH  North Central    11536504    310
36              Oklahoma  OK          South     3751351    111
37                Oregon  OR           West     3831074     36
38          Pennsylvania  PA      Northeast    12702379    457
39          Rhode Island  RI      Northeast     1052567     16
40        South Carolina  SC          South     4625364    207
41          South Dakota  SD  North Central      814180      8
42             Tennessee  TN          South     6346105    219
43                 Texas  TX          South    25145561    805
44                  Utah  UT           West     2763885     22
45               Vermont  VT      Northeast      625741      2
46              Virginia  VA          South     8001024    250
47            Washington  WA           West     6724540     93
48         West Virginia  WV          South     1852994     27
49             Wisconsin  WI  North Central     5686986     97
50               Wyoming  WY           West      563626      5</code></pre>
</div>
</div>
</section><section id="new-variables-.assign" class="level2"><h2 class="anchored" data-anchor-id="new-variables-.assign">New Variables <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.assign.html"><code>.assign</code></a>
</h2>
<ul>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code></p></li>
<li><p><span class="green">Have to use <code>murders.total</code> and <code>murders.population</code> instead of <code>total</code> and <code>popution</code>.</span></p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>murders <span class="op">=</span> murders.assign(</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>    rate <span class="op">=</span> <span class="bu">round</span>(murders.total <span class="op">/</span> murders.population <span class="op">*</span> <span class="dv">100000</span>, <span class="dv">2</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(murders.head(<span class="dv">5</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>        state abb region  population  total  rate
0     Alabama  AL  South     4779736    135  2.82
1      Alaska  AK   West      710231     19  2.68
2     Arizona  AZ   West     6392017    232  3.63
3    Arkansas  AR  South     2915918     93  3.19
4  California  CA   West    37253956   1257  3.37</code></pre>
</div>
</div>
<div class="notes">
<p>murders[‚Äòtotal‚Äô]</p>
</div>
</section><section id="filter-rows-.query" class="level2"><h2 class="anchored" data-anchor-id="filter-rows-.query">Filter Rows <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.query.html"><code>.query</code></a>
</h2>
<ul>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code></p></li>
<li><p><span class="green">Conditions must be a <strong>string</strong> to be evaluated!</span></p></li>
<li><p><span class="green">Cannot write <code>murders.rate</code>, and should use <code>rate</code>.</span></p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(murders.query(expr<span class="op">=</span><span class="st">"rate &lt; 0.7"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>            state abb         region  population  total  rate
11         Hawaii  HI           West     1360301      7  0.51
15           Iowa  IA  North Central     3046355     21  0.69
29  New Hampshire  NH      Northeast     1316470      5  0.38
34   North Dakota  ND  North Central      672591      4  0.59
45        Vermont  VT      Northeast      625741      2  0.32</code></pre>
</div>
</div>
</section><section id="select-columns-.filter" class="level2"><h2 class="anchored" data-anchor-id="select-columns-.filter">Select Columns <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.filter.html"><code>.filter</code></a>
</h2>
<ul>
<li><p><code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code></p></li>
<li><p><span class="green">Have to be strings</span></p></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(murders.<span class="bu">filter</span>(items<span class="op">=</span>[<span class="st">'region'</span>, <span class="st">'rate'</span>, <span class="st">'state'</span>]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           region   rate                 state
0           South   2.82               Alabama
1            West   2.68                Alaska
2            West   3.63               Arizona
3           South   3.19              Arkansas
4            West   3.37            California
5            West   1.29              Colorado
6       Northeast   2.71           Connecticut
7           South   4.23              Delaware
8           South  16.45  District of Columbia
9           South   3.40               Florida
10          South   3.79               Georgia
11           West   0.51                Hawaii
12           West   0.77                 Idaho
13  North Central   2.84              Illinois
14  North Central   2.19               Indiana
15  North Central   0.69                  Iowa
16  North Central   2.21                Kansas
17          South   2.67              Kentucky
18          South   7.74             Louisiana
19      Northeast   0.83                 Maine
20          South   5.07              Maryland
21      Northeast   1.80         Massachusetts
22  North Central   4.18              Michigan
23  North Central   1.00             Minnesota
24          South   4.04           Mississippi
25  North Central   5.36              Missouri
26           West   1.21               Montana
27  North Central   1.75              Nebraska
28           West   3.11                Nevada
29      Northeast   0.38         New Hampshire
30      Northeast   2.80            New Jersey
31           West   3.25            New Mexico
32      Northeast   2.67              New York
33          South   3.00        North Carolina
34  North Central   0.59          North Dakota
35  North Central   2.69                  Ohio
36          South   2.96              Oklahoma
37           West   0.94                Oregon
38      Northeast   3.60          Pennsylvania
39      Northeast   1.52          Rhode Island
40          South   4.48        South Carolina
41  North Central   0.98          South Dakota
42          South   3.45             Tennessee
43          South   3.20                 Texas
44           West   0.80                  Utah
45      Northeast   0.32               Vermont
46          South   3.12              Virginia
47           West   1.38            Washington
48          South   1.46         West Virginia
49  North Central   1.71             Wisconsin
50           West   0.89               Wyoming</code></pre>
</div>
</div>
</section><section id="grouping-.groupby-.agg" class="level2"><h2 class="anchored" data-anchor-id="grouping-.groupby-.agg">Grouping <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.groupby.html"><code>.groupby</code></a> + <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.agg.html"><code>.agg</code></a>
</h2>
<ul>
<li><code>dplyr::group_by() + dplyr::summarize()</code></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>heights <span class="op">=</span> pd.read_csv(<span class="st">'./data/heights.csv'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>heights.groupby(by<span class="op">=</span><span class="st">'sex'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;pandas.api.typing.DataFrameGroupBy object at 0x347442930&gt;</code></pre>
</div>
</div>
<p>. . .</p>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">## a data frame</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heights.groupby(by<span class="op">=</span><span class="st">'sex'</span>).agg(func<span class="op">=</span>[<span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'median'</span>, <span class="st">'min'</span>]))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           height                           
             mean       std     median   min
sex                                         
Female  64.939424  3.760656  64.980315  51.0
Male    69.314755  3.611024  69.000000  50.0</code></pre>
</div>
</div>
</section><section id="sorting-.sort_values" class="level2"><h2 class="anchored" data-anchor-id="sorting-.sort_values">Sorting <a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.sort_values.html"><code>.sort_values</code></a>
</h2>
<ul>
<li><code><a href="https://dplyr.tidyverse.org/reference/arrange.html">dplyr::arrange()</a></code></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(murders.sort_values(<span class="st">'population'</span>).head(<span class="dv">5</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   state abb         region  population  total   rate
50               Wyoming  WY           West      563626      5   0.89
8   District of Columbia  DC          South      601723     99  16.45
45               Vermont  VT      Northeast      625741      2   0.32
34          North Dakota  ND  North Central      672591      4   0.59
1                 Alaska  AK           West      710231     19   2.68</code></pre>
</div>
</div>
<p>. . .</p>
<ul>
<li><code>dplyr::arrange(desc())</code></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(murders.sort_values(<span class="st">'rate'</span>, ascending <span class="op">=</span> <span class="va">False</span>).head(<span class="dv">5</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   state abb         region  population  total   rate
8   District of Columbia  DC          South      601723     99  16.45
18             Louisiana  LA          South     4533372    351   7.74
25              Missouri  MO  North Central     5988927    321   5.36
20              Maryland  MD          South     5773552    293   5.07
40        South Carolina  SC          South     4625364    207   4.48</code></pre>
</div>
</div>


<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script><div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
W10=
</script></section></section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>We can use <code><a href="https://tibble.tidyverse.org/reference/add_column.html">tibble::add_column()</a></code> to add one or more columns to an existing data frame.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>See help for any of these functions for more info, e.g.&nbsp;<code>?num_range</code>.<a href="#fnref2" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol></section></div></main><!-- /main --><script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script><script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../slides";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script><script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/math3570-s26\.github\.io\/website\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>¬© Copyright 2026, Cheng-Han Yu</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions"><ul><li><a href="https://github.com/math3570-s26/website/edit/main/slides/12-dplyr-1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/math3570-s26/website/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This page is built with ‚ù§Ô∏è and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>